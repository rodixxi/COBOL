\Cobol\fuentes\PLAS001.cbl Fri Nov 20 21:55:49 2015  ACUCOBOL-GT v7.2.0  Page: 0001
ccbl32 -Cr -Ce -Vxe3 -vc -Zl -zd -Zz -Fx3 -Lo @.lst -o \Cobol\PLAS001.acu -Lf \Cobol\fuentes\PLAS001.cbl


      * =================================================================== */
      *                                                                     */
      *   COBOLNAME.CBL                                                     */
      *   (C) 2008 AUTHOR                                                   */
      *                                                                     */
      *   DESCRIPTION                                                       */
      *                                                                    .*/
      * =================================================================== */
      *PROGRAM DESCRIPTION
       IDENTIFICATION DIVISION.
       PROGRAM-ID. LIS001.
       AUTHOR. CRESPILLO RODRIGO ANDRES.
       INSTALLATION.
       DATE-WRITTEN. 19/11/2015.
       DATE-COMPILED.
      *----------------------------------------------------------------
       ENVIRONMENT DIVISION.

       CONFIGURATION SECTION.
       SOURCE-COMPUTER. NOMBRE COMPUTADIR FUENTE.
       OBJECT-COMPUTER. NOMBRE COMPUTADOR OBJETO.
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.

       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT M-CUENTAS
           ASSIGN TO "\COBOL\arch\mcuentas2"
           ORGANIZATION IS SEQUENTIAL.
           SELECT LISTADO
           ASSIGN TO "\COBOL\listado\LISTADO-PLAS001"
           ORGANIZATION IS SEQUENTIAL.
       COPY "\COBOL\fuentes\cpy\plasticos.sel".
           SELECT M-PLASTICOS ASSIGN TO DISK
                              "\COBOL\arch\plasticos.idx"
                              ORGANIZATION IS INDEXED
                              ACCESS MODE  IS DYNAMIC
                              RECORD KEY   IS PLAS-CLAVE
                    ALTERNATE RECORD KEY   IS PLAS-CLAVE-1
                              WITH DUPLICATES
                              FILE STATUS  IS DB-STAT.
      *----------------------------------------------------------------
       DATA DIVISION.

       FILE SECTION.

       COPY "\COBOL\fuentes\cpy\fd-ctas-reg.fds".
       FD  M-CUENTAS.
       01  CTAS-REG.
            03 CTAS-DOCUMENTO           PIC 9(08).
            03 CTAS-APELLIDO            PIC X(20).
            03 CTAS-NOMBRE              PIC X(20).
            03 CTAS-FECHA-NAC.
             05 CTAS-FECHA-NAC-ANHO      PIC 9999.
             05 CTAS-FECHA-NAC-MES       PIC 99.
             05 CTAS-FECHA-NAC-DIA       PIC 99.

\Cobol\fuentes\PLAS001.cbl Fri Nov 20 21:55:49 2015  ACUCOBOL-GT v7.2.0  Page: 0002


            03 CTAS-PROVINCIA           PIC X(01).
            03 CTAS-APERTURA            PIC 9(01).
            03 CTAS-SITUACION           PIC 9(01).
            03 CTAS-SALDO               PIC S9(10)V99.
            03 CTAS-FECHA-BAJA          PIC 9(08).
            03 FILLER                   PIC X(21).

       FD  M-PLASTICOS.
       COPY "\COBOL\fuentes\cpy\plasticos.fds".
      *********************************
      * Archivo:   Maestro plasticos  *
      * Nombre F¡sico:  plasticos.idx *
      *********************************
       01  PLAS-REG.
           03 PLAS-CLAVE.
              05 PLAS-PLASTICO      PIC 9(16).
           03 PLAS-CLAVE-1.
              05 PLAS-DOCUMENTO     PIC 9(08).
                 03 PLAS-NOMBRE-CORTO     PIC X(25).
           03 PLAS-ESTADO           PIC X(02).
           03 PLAS-FECHA-EMITIDO    PIC 9(08).
           03 PLAS-FECHA-DESDE      PIC 9(08).
           03 PLAS-FECHA-HASTA      PIC 9(08).
           03 FILLER                PIC X(13).


       FD  LISTADO.
       01  REG-LIS                      PIC X(100).

       WORKING-STORAGE SECTION.

       COPY "\COBOL\fuentes\cpy\wk-fecha-vuelta.cpy".
       01  WK-FECHA                     PIC 9(08).
       01  FILLER REDEFINES  WK-FECHA.
            03 WK-FEC-ANHIO             PIC X(04).
            03 WK-FEC-MES               PIC X(02).
            03 WK-FEC-DIA               PIC X(02).

       01  WK-FECHA-ED.
            03 WK-FEC-DIA-ED            PIC X(02).
            03 FILLER                   PIC X VALUE "/".
            03 WK-FEC-MES-ED            PIC X(02).
            03 FILLER                   PIC X VALUE "/".
            03 WK-FEC-ANHIO-ED          PIC X(04).


       77  WK-FINAL                     PIC 9.
       77  WK-LINEA                     PIC 9(04).
       77  WK-LEIDOS                    PIC 9(04).
       77  WK-PLAS-FINAL                PIC 9.
       77  WK-SIN-PLAS                  PIC 9.
       77  WK-PLASTICOS                 PIC 9(04).
       77  WK-PLASTICOS-CONCIDERADO     PIC 9(04).

       01  DB-STAT                      PIC X(02).

       01  TAB-MESES                    PIC X(36)

\Cobol\fuentes\PLAS001.cbl Fri Nov 20 21:55:49 2015  ACUCOBOL-GT v7.2.0  Page: 0003


           VALUE "ENEFEBAMRABRMAYJUNJULAGOSETOCTNOVDIC".
       01  FILLER REDEFINES TAB-MESES.
           03 TAB-MES                   PIC X(3) OCCURS 12.

       01  WK-FECHA-HASTA               PIC 9(08).
       01  FILLER REDEFINES WK-FECHA-HASTA.
           03 WK-FECHA-HASTA-ANHIO      PIC 9999.
           03 WK-FECHA-HASTA-MES        PIC 99.
           03 WK-FECHA-HASTA-DIA        PIC 99.


       01  WK-FECHA-HASTA-ED.
           03 WK-FECHA-HASTA-MES-ED     PIC X(03).
           03 FILLER                    PIC X VALUE "-".
           03 WK-FECHA-HASTA-ANHIO-ED   PIC 9999.

       01  WK-PLAS-PLASTICO             PIC 9(16).
       01  FILLER REDEFINES WK-PLAS-PLASTICO.
           03 WK-PLASTICO-1             PIC X(04).
           03 WK-PLASTICO-2             PIC X(04).
           03 WK-PLASTICO-3             PIC X(04).
           03 WK-PLASTICO-4             PIC X(04).

       01  WK-PLAS-PLASTICO-ED.
           03 WK-PLASTICO-1-ED          PIC X(04).
           03 FILLER                    PIC X VALUE "-".
           03 WK-PLASTICO-2-ED          PIC X(04).
           03 FILLER                    PIC X VALUE "-".
           03 WK-PLASTICO-3-ED          PIC X(04).
           03 FILLER                    PIC X VALUE "-".
           03 WK-PLASTICO-4-ED          PIC X(04).

       01  TITULO-01.
            03 TIT-FECHA                PIC X(10).
            03 FILLER                   PIC X(25) VALUE SPACES.
            03 FILLER                   PIC X(30) VALUE
            "LISTADO DE PLASTICOS A REPONER".
            03 FILLER                   PIC X(26) VALUE SPACES.
            03 FILLER                   PIC X(06) VALUE "HOJA: ".
            03 TIT-HOJA                 PIC 9(03).

       01  TITULO-LINE                  PIC X(100) VALUE ALL "_".

       01  TITULO-03.
            03 FILLER                   PIC X(09) VALUE "Cuenta".
            03 FILLER                   PIC X(05) VALUE ALL SPACES.
            03 FILLER                   PIC X(07) VALUE "Titular".
            03 FILLER                   PIC X(18) VALUE ALL SPACES.
            03 FILLER                   PIC X(03) VALUE "Prv".
            03 FILLER                   PIC X(18) VALUE ALL SPACES.
            03 FILLER                   PIC X(04) VALUE "Aper".
            03 FILLER                   PIC X(06) VALUE ALL SPACES.
            03 FILLER                   PIC X(08) VALUE "Plastico".
            03 FILLER                   PIC X(07) VALUE ALL SPACES.
            03 FILLER                   PIC X(03) VALUE "Est".
            03 FILLER                   PIC X(07) VALUE ALL SPACES.
            03 FILLER                   PIC X(05) VALUE "Hasta".

\Cobol\fuentes\PLAS001.cbl Fri Nov 20 21:55:49 2015  ACUCOBOL-GT v7.2.0  Page: 0004



       01  LIN-DETALLE.
            03 L-DOC                    PIC 9(08).
            03 FILLER                   PIC X(05) VALUE ALL SPACES.
            03 L-NOM-CORTO              PIC X(25).
            03 FILLER                   PIC X(05) VALUE ALL SPACES.
            03 L-PROV                   PIC X.
            03 FILLER                   PIC X(05) VALUE ALL SPACES.
            03 L-APER                   PIC 9.
            03 FILLER                   PIC X(07) VALUE ALL SPACES.
            03 L-PLAS                   PIC X(19).
            03 FILLER                   PIC X(06) VALUE ALL SPACES.
            03 L-EST                    PIC XX.
            03 FILLER                   PIC X(06) VALUE ALL SPACES.
            03 L-FHAS                   PIC X(08).

       01  TITULO-BOTTOM-LEIDOS.
            03 FILLER                   PIC X(20) VALUE
            "Cuestas Leidas....: ".
            03 LIN-TOT-ALUMN            PIC ZZZZZ9.
       01  TITULO-BOTTOM-REPONER.
            03 FILLER                   PIC X(20) VALUE
            "Plasticos a repoer: ".
            03 LIN-TOT-PLAS-EX            PIC ZZZZZ9.

       LINKAGE SECTION.
       SCREEN SECTION.
      *----------------------------------------------------------------
       PROCEDURE DIVISION.

       CONTROL-PROG.
000005     PERFORM INICIO     THRU F-INICIO
000009     PERFORM PROCESO    THRU F-PROCESO
00000D     PERFORM FINAL-PROG THRU F-FINAL-PROG
000011     GOBACK.

      * ABRE ARCHIVO Y ANHADE ENCABEZADO
       INICIO.
00001B     PERFORM ABRIR-ARCHIVO THRU F-ABRIR-ARCHIVO
00001F     PERFORM ENCABEZAR     THRU F-ENCABEZAR.
       F-INICIO.

      * ABRE EL ARCHIVO
       ABRIR-ARCHIVO.
00002B     OPEN INPUT M-CUENTAS
000036     OPEN INPUT M-PLASTICOS
000041     OPEN OUTPUT LISTADO.
       F-ABRIR-ARCHIVO.

       ENCABEZAR.
      * ACEPTA HORA DEL SISTEMA Y LA PONE EN EL LISTADO
000054     ACCEPT WK-FECHA FROM CENTURY-DATE

00005A     PERFORM MOVER-FECHA THRU F-MOVER-FECHA
00005E     MOVE WK-FECHA-ED  TO TIT-FECHA

000065     ADD 1 TO TIT-HOJA

\Cobol\fuentes\PLAS001.cbl Fri Nov 20 21:55:50 2015  ACUCOBOL-GT v7.2.0  Page: 0005



      * IMPRIME ENCABEZADO
00006B     WRITE REG-LIS FROM TITULO-01
00007D     WRITE REG-LIS FROM TITULO-LINE
00008F     WRITE REG-LIS FROM TITULO-03
0000A1     WRITE REG-LIS FROM TITULO-LINE

0000B3     MOVE 4 TO WK-LINEA.

       F-ENCABEZAR.

       PROCESO.
0000C1     PERFORM UNTIL WK-FINAL= 1
0000CB        READ M-CUENTAS AT END
0000D7             MOVE 1 TO WK-FINAL
0000DD             EXIT PERFORM CYCLE
              END-READ
0000E1        ADD 1 TO WK-LEIDOS

0000E7            INITIALIZE WK-SIN-PLAS
                             LIN-DETALLE
                             WK-PLAS-FINAL
000110            IF CTAS-FECHA-BAJA = 0 AND
                  (CTAS-APERTURA = 1 OR  2 OR 3)
000135                  MOVE CTAS-DOCUMENTO TO PLAS-DOCUMENTO
00013C                  START M-PLASTICOS KEY GREATER OR EQUAL
                        PLAS-CLAVE-1
                        INVALID KEY
00014A                      MOVE 1 TO WK-SIN-PLAS
000150                      DISPLAY MESSAGE "Documento no Encontrado"
                            END-DISPLAY
000158                      EXIT PERFORM CYCLE
                        END-START
00015C                  PERFORM UNTIL WK-PLAS-FINAL = 1
000166                      READ M-PLASTICOS NEXT AT END
000172                           MOVE 1 TO WK-PLAS-FINAL
000178                           EXIT PERFORM CYCLE
                            END-READ
00017C                      IF PLAS-ESTADO <> "EX"
000185                           EXIT PERFORM CYCLE
                            END-IF
000189                      IF CTAS-DOCUMENTO <> PLAS-DOCUMENTO
000193                          EXIT PERFORM
                            END-IF
      * SI EL CONTADOR ES MAYOR A 64 AGREGO 1 HOJA
000197                      IF WK-LINEA > 64
0001A1                          PERFORM ENCABEZAR THRU F-ENCABEZAR
                            END-IF
0001A5                      ADD 1 TO WK-PLASTICOS-CONCIDERADO
0001AB                      PERFORM DETALLE THRU F-DETALLE

                        END-PERFORM
                    END-IF
           END-PERFORM.
       F-PROCESO.



\Cobol\fuentes\PLAS001.cbl Fri Nov 20 21:55:50 2015  ACUCOBOL-GT v7.2.0  Page: 0006


       DETALLE.
0001BD     MOVE CTAS-DOCUMENTO       TO L-DOC
0001C4     MOVE PLAS-NOMBRE-CORTO    TO L-NOM-CORTO
0001CB     MOVE CTAS-PROVINCIA       TO L-PROV
0001D1     MOVE CTAS-APERTURA        TO L-APER
0001D7     IF WK-SIN-PLAS = 0
           THEN
0001E1          MOVE PLAS-PLASTICO        TO WK-PLAS-PLASTICO
           ELSE
0001EB          MOVE 9999999999999999     TO WK-PLAS-PLASTICO
           END-IF
0001F2     PERFORM CODIGO-PLASTICO   THRU F-CODIGO-PLASTICO
0001F6     MOVE PLAS-ESTADO          TO L-EST
0001FC     PERFORM FECHA-HASTA       THRU F-FECHA-HASTA
000200     WRITE REG-LIS FROM LIN-DETALLE
000213     ADD 1 TO WK-PLASTICOS
000219     ADD 1 TO WK-LINEA.
       F-DETALLE.

       FECHA-HASTA.
000227     MOVE PLAS-FECHA-HASTA TO WK-FECHA-HASTA
00022E     MOVE TAB-MES (WK-FECHA-HASTA-MES) TO WK-FECHA-HASTA-MES-ED
00023B     MOVE WK-FECHA-HASTA-ANHIO TO WK-FECHA-HASTA-ANHIO-ED
000241     MOVE WK-FECHA-HASTA-ED TO L-FHAS.
       F-FECHA-HASTA.

       CODIGO-PLASTICO.
000250     MOVE WK-PLASTICO-1 TO WK-PLASTICO-1-ED
000256     MOVE WK-PLASTICO-2 TO WK-PLASTICO-2-ED
00025C     MOVE WK-PLASTICO-3 TO WK-PLASTICO-3-ED
000262     MOVE WK-PLASTICO-4 TO WK-PLASTICO-4-ED
000268     MOVE WK-PLAS-PLASTICO-ED TO L-PLAS.
       F-CODIGO-PLASTICO.

       FINAL-PROG.
000277     PERFORM TOTALES           THRU F-TOTALES
00027B     PERFORM CERRAR-ARCHIVO    THRU F-CERRAR-ARCHIVO
00027F     PERFORM VERIFICAR-TOTALES THRU F-VERIFICAR-TOTALES.
       F-FINAL-PROG.

       TOTALES.
      * IMPRIME PIE DE PAGINA CON TOTAL DE ALUMNOS
00028B     IF WK-LINEA > 63
000295      PERFORM ENCABEZAR
           END-IF
000299     MOVE WK-LEIDOS    TO LIN-TOT-ALUMN
0002A0     MOVE WK-PLASTICOS TO LIN-TOT-PLAS-EX
0002A7     WRITE REG-LIS FROM TITULO-LINE
0002B9     WRITE REG-LIS FROM TITULO-BOTTOM-LEIDOS
0002CC     WRITE REG-LIS FROM TITULO-BOTTOM-REPONER.
       F-TOTALES.

       VERIFICAR-TOTALES.
0002E7     DISPLAY "Cuentas leidas: "   AT 1016 WK-LEIDOS CONVERT
0002F5     DISPLAY "Plasticos a reponer: "
           AT 1216 WK-PLASTICOS CONVERT
000303     DISPLAY "consi: "   AT 1416 WK-PLASTICOS-CONCIDERADO CONVERT

\Cobol\fuentes\PLAS001.cbl Fri Nov 20 21:55:50 2015  ACUCOBOL-GT v7.2.0  Page: 0007


000311     DISPLAY "extra: "   AT 1016 WK-PLASTICOS CONVERT
00031F     DISPLAY MESSAGE "Enter para continuar"
           END-DISPLAY
000327     IF WK-PLASTICOS-CONCIDERADO <> WK-PLASTICOS
000331        DISPLAY MESSAGE "Cuentas no balancean"
              END-DISPLAY
           END-IF.
       F-VERIFICAR-TOTALES.

       CERRAR-ARCHIVO.
000341     CLOSE M-CUENTAS
                 M-PLASTICOS
                 LISTADO.
       F-CERRAR-ARCHIVO.

       COPY "\COBOL\fuentes\cpy\procedure-fecha-vuelta.cpy".
       MOVER-FECHA.
000368     MOVE WK-FEC-ANHIO TO WK-FEC-ANHIO-ED
00036E     MOVE WK-FEC-MES   TO WK-FEC-MES-ED
000374     MOVE WK-FEC-DIA   TO WK-FEC-DIA-ED.
       F-MOVER-FECHA.
      *----------------------------------------------------------------

\Cobol\fuentes\PLAS001.cbl Fri Nov 20 21:55:50 2015  ACUCOBOL-GT v7.2.0  Page: 0008


STATISTICS

Total Lines:         363
# of Files:            3
# of Data Items:     114
# of Paragraphs:      25

Elapsed Time:        1.4 seconds
Lines/Minute:      15557


Code Size:           899 (000383)
Data Size:          1396 (000574)
Shared Data:          14 (00000E)
Extra Segment:       242 (0000F2)
Thread Segment:      100 (000064)
Address Table:       264 (000108)
Program Size:       2915 (000B63)

0 Error(s), 0 Warning(s)
